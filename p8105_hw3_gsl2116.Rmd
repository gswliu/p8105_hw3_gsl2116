---
title: "Visualization and EDA"
author: "Grace Liu"
date: "10/11/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

devtools::install_github("p8105/p8105.datasets") # install.packages("devtools")
library(p8105.datasets)
```

## Problem 1
```{r problem_1}
brfss_data = brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health")

brfss_data$response = factor(c("Excellent", "Very good", "Good", "Fair", "Poor"))
```

**In 2002, which states were observed at 7 locations? **
```{r problem_1a}
brfss_data %>% 
  group_by(year, locationabbr) %>% 
  filter(year == 2002) %>% 
  summarize(n_locations = n_distinct(locationdesc) == 7) %>% 
  filter(n_locations == TRUE)
```

In 2002, there were 3 states where 7 locations were observed.  

**“Spaghetti plot” showing the number of locations in each state from 2002 to 2010**
```{r problem_1b}
brfss_data %>%
  group_by(year, locationabbr) %>%
  count(n_locations = n_distinct(locationdesc)) %>% 
  ggplot(aes(x = year, y = n_locations, color = locationabbr)) + 
    geom_smooth(se = FALSE, alpha = .5) +
    labs(
      title = "Number of locations in each state, 2002-2010",
      x = "Year",
      y = "Number of locations") + 
    theme_minimal()
```

The graph above shows the count of locations observed in each (plus DC) for each year between 2002 to 2010.

**Proportion of “Excellent” responses across locations in NY State**
```{r problem_1c}
brfss_data %>%
  group_by(year) %>%
  filter(locationabbr == "NY" & year %in% c(2002, 2006, 2010) & response == "Excellent") %>%
  summarize(mean_excellent = mean(data_value, na.rm = TRUE), 
            sd_excellent = sd(data_value, na.rm = TRUE)) %>% 
  knitr::kable(digits = 2)
```

The mean (standard deviation) of the proportion of “Excellent” responses across locations in NY State was 26.76 (8.48) in 2002, 15.97 (10.03) in 2006, and 17.30 (8.99) in 2010.  

**Average proportion in each response category, by response and state**
```{r problem_1d}
brfss_data %>%
  group_by(year, locationabbr, response) %>%
  summarize(mean_response = mean(data_value, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = mean_response, color = locationabbr)) + 
    geom_smooth(se = FALSE, alpha = .5) +
    labs(
      title = "Average proportion in each response category",
      x = "Year",
      y = "Average proportion") + 
    theme_minimal() +
    facet_grid(~response)
```

The above graph shows, for each response category, the distribution of state-level average proportions over time.  

## Problem 2
```{r problem_2, include=FALSE}
instacart_data = instacart
```
**Short description of the dataset**  
This dataset has 1,384,617 observations in 15 variables, with `r nrow(instacart_data)` rows and `r ncol(instacart_data)` columns. There are `r instacart_data %>% summarize(n_distinct(department))` departments with `r instacart_data %>% summarize(n_distinct(aisle_id))` distinct aisles containing `r instacart_data %>% summarize(n_distinct(product_name))` products. This dataset summarizes the contents of `r instacart_data %>% summarize(n_distinct(order_id))` distinct orders placed.

**How many aisles are there, and which aisles are the most items ordered from?**  
There are `r instacart_data %>% summarize(n_distinct(aisle_id))` aisles. 
```{r}
instacart_data %>% 
  group_by(aisle_id, aisle, product_name) %>% 
  which.max(product_name)

sort(table(instacart_data$product_name, descending = TRUE))

instacart_data %>%
  group_by(product_name) %>% 
  max(count(product_name)) %>% 
  rev(sort(unique(product_name))) [1:5] %>% 
  summarize(n_obs = n())
```


Make a plot that shows the number of items ordered in each aisle. Order aisles sensibly, and organize your plot so others can read it.
Make a table showing the most popular item in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”.
Make a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week; format this table for human readers (i.e. produce a 2 x 7 table).

